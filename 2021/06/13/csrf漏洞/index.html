<!DOCTYPE html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="csrf漏洞"><meta name="author" content="keikei"><meta name="keywords" content=""><meta name="copyright" content="copyright.liscense_type"><title>Csrf漏洞</title><!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]><script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script><script src="https://cdn.bootcss.com/respond/1.4.2/respond.min.js"></script><![endif]--><link rel="icon" href="/compass/imgs/favicon.ico"><link rel="stylesheet" href="/compass/stylesheets/font-awesome.min.css"><script>var algoliaConfig = {"on":false}</script><link rel="stylesheet" href="/compass/stylesheets/screen.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="body-inner-wrapper"><header id="page-header"><nav id="nav"><div id="site-name">My blog</div><i class="fa fa-bars fa-2x" id="nav-icon" aria-hidden="true"></i><div id="nav-expanded"><a class="nav-word-item" href="/">Home</a><a class="nav-word-item" href="/archives">Archives</a><a class="nav-word-item" href="/tags">Tags</a><a class="nav-word-item" href="/categories">Catogories</a></div><div id="nav-list"><ul><li><a class="nav-list-item" href="/">Home</a></li><li><a class="nav-list-item" href="/archives">Archives</a></li><li><a class="nav-list-item" href="/tags">Tags</a></li><li><a class="nav-list-item" href="/categories">Catogories</a></li></ul></div></nav><div id="banner-wrapper"><div id="banner-pagetype-dependent-info"><h1 id="post-title">Csrf漏洞</h1><span id="post-description"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-06-13</span><span id="word-count">The total word count - 965</span><span id="time-count">Estimated time of reading - 4 mins</span></div></div><a title="Back to Top"><i class="fa fa-arrow-up" id="to-Top" aria-hidden="true"></i></a><a title="Click to Toggle off"><i class="fa fa-toggle-on" id="toggle-on-Toc" aria-hidden="true"></i></a><a title="Click to Toggle on"><i class="fa fa-toggle-off" id="toggle-off-Toc" aria-hidden="true"></i></a></header><aside id="toc-column"><div id="toc-column-inner-wrapper"><div id="post-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#csrf%E6%BC%8F%E6%B4%9E%EF%BC%88%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81%E6%BC%8F%E6%B4%9E%EF%BC%89"><span class="toc-text">csrf漏洞（点击劫持漏洞）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AFcsrf%E6%BC%8F%E6%B4%9E%EF%BC%88%E7%82%B9%E5%87%BB%E5%8A%AB%E6%8C%81%E6%BC%8F%E6%B4%9E%EF%BC%89"><span class="toc-text">1.什么是csrf漏洞（点击劫持漏洞）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-csrf%E6%BC%8F%E6%B4%9E%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.csrf漏洞类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-get%E8%AF%B7%E6%B1%82%E7%9A%84csrf%E6%94%BB%E5%87%BB%EF%BC%88%E6%9B%B4%E5%AE%B9%E6%98%93%E8%A2%AB%E4%BF%A1%E4%BB%BB%EF%BC%89"><span class="toc-text">1.get请求的csrf攻击（更容易被信任）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-post%E8%AF%B7%E6%B1%82%E7%9A%84csrf%E6%94%BB%E5%87%BB"><span class="toc-text">2.post请求的csrf攻击</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-csrf%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98"><span class="toc-text">3.csrf漏洞挖掘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-burp%E9%AA%8C%E8%AF%81csrf%E5%8E%9F%E7%90%86"><span class="toc-text">4.burp验证csrf原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8E%9F%E7%90%86"><span class="toc-text">1.原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3"><span class="toc-text">5.漏洞危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D"><span class="toc-text">6.漏洞修复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-referer%E9%AA%8C%E8%AF%81"><span class="toc-text">1.referer验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-token%E6%A0%A1%E9%AA%8C"><span class="toc-text">2.token校验</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text"></span></a></li></ol></li></ol></li></ol></div></div></aside><main id="main-content-column"><div id="main-content-wrapper"><div id="post-full-content"><h1 id="csrf漏洞（点击劫持漏洞）"><a href="#csrf漏洞（点击劫持漏洞）" class="headerlink" title="csrf漏洞（点击劫持漏洞）"></a>csrf漏洞（点击劫持漏洞）</h1><h3 id="1-什么是csrf漏洞（点击劫持漏洞）"><a href="#1-什么是csrf漏洞（点击劫持漏洞）" class="headerlink" title="1.什么是csrf漏洞（点击劫持漏洞）"></a>1.什么是csrf漏洞（点击劫持漏洞）</h3><p>利用站点对已经身份认证的信任，在用户不知情的时候，去劫持用户的一些请求，比如跳转到某一钓鱼网站等等，利用用户的身份进行恶意操作（借用户权限完成攻击）<strong>所以在csrf漏洞中骗取用户信任也很重要</strong>，越容易让用户信任去点击，攻击的成功性就越高</p>
<p><img src="/.com//20200219221037596.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">验证csrf原理：要验证CSRF，需要在访问网站A后并获得cookie后，再访问一个会返回恶意代码的网站B，返回的恶意代码必须能导致浏览器访问网站A ，如果能通过返回的恶意代码访问到A，且A正常响应，说明存在CSRF漏洞。</span><br></pre></td></tr></table></figure>

<h3 id="2-csrf漏洞类型"><a href="#2-csrf漏洞类型" class="headerlink" title="2.csrf漏洞类型"></a>2.csrf漏洞类型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.get请求：get请求更容易得到用户信任，比post更危险</span><br><span class="line">2.post请求：post请求相对信任度较低</span><br></pre></td></tr></table></figure>

<h4 id="1-get请求的csrf攻击（更容易被信任）"><a href="#1-get请求的csrf攻击（更容易被信任）" class="headerlink" title="1.get请求的csrf攻击（更容易被信任）"></a>1.get请求的csrf攻击（更容易被信任）</h4><p>get请求的csrf攻击只需要发送一个http请求</p>
<p>例如:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">http://wooyun.org/csrf?xx</span>=<span class="string">11</span> /&gt;</span> </span><br></pre></td></tr></table></figure>

<p>在访问含有这个img的页面后，成功向<a target="_blank" rel="noopener" href="http://wooyun.org/csrf?xx=11">http://wooyun.org/csrf?xx=11</a> 发出了一次HTTP请求。所以，如果将该网址替换为存在GET型CSRF的地址，就能完成攻击了。</p>
<h4 id="2-post请求的csrf攻击"><a href="#2-post请求的csrf攻击" class="headerlink" title="2.post请求的csrf攻击"></a>2.post请求的csrf攻击</h4><p>这种类型的CSRF危害没有GET型的大，利用起来通常使用的是一个自动提交的表单（与用户信任度有关）</p>
<p>1.打开页面无需点击。自动跳转</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">http://wooyun.org/csrf.php</span> <span class="attr">method</span>=<span class="string">POST</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;xx&quot;</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> <span class="built_in">document</span>.forms[<span class="number">0</span>].submit(); &lt;<span class="regexp">/script  /</span><span class="regexp">/自动提交的表单（发送请求自动跳转到）,js脚本一句话的话可以不加“;”</span></span></span><br></pre></td></tr></table></figure>

<p>2.打开页面隐藏数据包成功状态</p>
<p>设置属性为width=0 height=0,就可以隐藏数据包返回数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;这里放一个图片的url&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srchttp:</span>//<span class="attr">wooyun.org</span>/<span class="attr">csrf</span>?<span class="attr">xx</span>=<span class="string">11</span> <span class="attr">width</span>=<span class="string">&quot;0&quot;</span> <span class="attr">height</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-csrf漏洞挖掘"><a href="#3-csrf漏洞挖掘" class="headerlink" title="3.csrf漏洞挖掘"></a>3.csrf漏洞挖掘</h3><p>1.判断一个网站是否存在CSRF漏洞，其实就是判断其对关键信息（比如密码等敏感信息）的操作(增删改)是否容易被伪造。</p>
<p>2.csrf漏洞往往存在于能够越权的地方</p>
<h3 id="4-burp验证csrf原理"><a href="#4-burp验证csrf原理" class="headerlink" title="4.burp验证csrf原理"></a>4.burp验证csrf原理</h3><h4 id="1-原理"><a href="#1-原理" class="headerlink" title="1.原理"></a>1.原理</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">burp把自己当成恶意服务器，当用户通过访问可信任浏览器访问burp(恶意服务器)，burpsuite返回给浏览器的代码中含有要求访问可信任网站的代码，如果用户点击能够成功访问受信任网站，则说明存在csrf漏洞![](csrf漏洞.assets/burp验证1.PNG</span><br></pre></td></tr></table></figure>

<h3 id="5-漏洞危害"><a href="#5-漏洞危害" class="headerlink" title="5.漏洞危害"></a>5.漏洞危害</h3><p>漏洞危害取决于你修改/添加/删除的是什么数据</p>
<h3 id="6-漏洞修复"><a href="#6-漏洞修复" class="headerlink" title="6.漏洞修复"></a>6.漏洞修复</h3><h4 id="1-referer验证"><a href="#1-referer验证" class="headerlink" title="1.referer验证"></a>1.referer验证</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">referer代表着请求的来源，不可以伪造,但是浏览器可以关闭referer，但是火狐已经可以篡改referer</span><br><span class="line">//referer和origin的区别，只有post请求会携带origin请求头，而referer不论何种情况下都带。</span><br></pre></td></tr></table></figure>

<p>在服务器端的http header中的referer字段，服务器判断referer是否是自己的站点，如果不是则拒绝服务。</p>
<h4 id="2-token校验"><a href="#2-token校验" class="headerlink" title="2.token校验"></a>2.token校验</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token有些像验证码，但是有些网站的token是摆设，要抓包看token是否有效</span><br></pre></td></tr></table></figure>

<p><strong>1.token校验原理</strong>后端生成一个token放在session中并发给前端，前端发送请求时携带这个token，后端通过校验这个token和session中的token是否一致判断是否是本网站的请求。</p>
<h3 id><a href="#" class="headerlink" title></a></h3></div></div></main><div id="pagination-wrapper"><a id="page-prev" href="/2021/06/13/url%E8%B7%B3%E8%BD%AC%E6%BC%8F%E6%B4%9E/"><i class="fa fa-chevron-left"></i> url跳转漏洞</a><a id="page-next" href="/2021/06/13/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/">文件上传漏洞 <i class="fa fa-chevron-right"></i></a></div><footer id="page-footer"><div id="footer-wrapper"><div id="blog-meta">&copy;2017-2021 By keikei | Theme - <a id='theme-name' target="_blank" rel="noopener" href="https://github.com/huan555/lemon-lime"> Lemon-Lime</a> | Power By <a id='theme-powered-by' href=http://hexo.io> Hexo</a></div><div id="viewed-record"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span></span></div><div id="copyright-wrapper"><i class="fa fa-cc" aria-hidden="true"></i><div id="copyright">Except where otherwise noted, content on this blog is licensed under <a rel="license" href=http://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a>.</div></div><div id="contact-me"><div id="rss"><a href="/atom.xml" type="application/atom+xml" rel="alternate" target="_blank"><i class="fa fa-rss" aria-hidden="true"></i></a></div><span id="github"><a target="_blank" rel="noopener" href="https://github.com/yourUserName"><i class="fa fa-github" aria-hidden="true"></i></a></span></div></div></footer><script src="/compass/js/blog.js"></script></div></body>